The OBC software folder named Flight_code_V4 was uploaded in to git repository on 17 JULY 2020

Status of software while uploading in to Git : 3 July 2020 for TCH storage TM.

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
++++++++++++++++++++++++++++ Changes log ++++++++++++++++++++++++++++
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	++++++++++++++++++++++++++++++++
	+ Changes made on 18 JULY 2020 +
	++++++++++++++++++++++++++++++++

1. Remote_patch.c and Remote_patch.h added to the project location
2. entry hook and exit hook for all mode processing functions.
3. Done necessary declarations in Global.h
4. Added Remote_patch.c in Make file
5. TCH warnings (incompatable pointer to integer assignment) has been
   cleared  in Global.c, Func = rPORinit()
6. Implicit declaration of function ST_TM_gps_data() in GPS_OD.c is 
   been resolved
7. HAL_GPS_Read function incompatible pointer assignment from 
   struct GPS_No to unsigned long int GPS_Buffer_Addr is resolved.


Func execute command
1.GPS config command names are modified
2.Roll_Torquer_ON and Roll_Torquer_OFF names are changed to TC_MTR_ON 
  and TC_MTR_OFF respectively.

3. Reaction wheel TC_Ping_RW1, TC_Ping_RW2, TC_Ping_RW3, and TC_Ping_RW4
   changed to TC_init_RW1 TC_init_RW2 TC_init_RW3, and TC_init_RW4 respectively.
4. Definition of struct HAL_RW_Data_Structure which was in HAL_RW.h is now
   defined in HAL_Global.h
5. rRW_init_cmd is called in Telecommand.c instead of Function rRW_Ping_TC1,
   rRW_Ping_TC2, rRW_Ping_TC3, and rRW_Ping_TC4 which are now eliminated.

6. Func exe EEPROM_CHECK_COMMAND  is replaced by S_band_tx_on


+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	++++++++++++++++++++++++++++++++
	+ Changes made on 23 JULY 2020 +
	++++++++++++++++++++++++++++++++
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
1. Storage telemetry command names are modified



+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	++++++++++++++++++++++++++++++++
	+ Changes made on 24 JULY 2020 +
	++++++++++++++++++++++++++++++++
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

1. Removed Remote_block_select (unused) Data telecommand from data command list.
2. Added TC_Mag_Misalignment_IMU1, TC_Mag_Misalignment_IMU2, 
	TC_Mag_Scale_Factor_IMU1, TC_Mag_Scale_Factor_IMU2,
	TC_SS_misalnCM1256, TC_SS_misalnCM2356,
	TC_SS_misalnCM3456, TC_SS_misalnCM4156,
	TC_SS_Imax_ALPHA offsets in rADCS_Data_TC function.
3. Removed TC_Tle from the adcs data command list as it was decided to use
   remote data command for TLE.
4. Offset addresses in adcs data command structure and case statement in 
   rADCS_Data_TC function are revised.
5. Payload data commands data type is changed from float to integer.

6. Software Bug removal according to the report generated by Polyspace bugfinder
	a) for loop index i name changed to gps_data_copy_index 
	  in file: HAL_GPS.c, function name: ST_TM_gps_data  

	b) for loop index i name changed to eeprom_chksum_index
	  in file: HAL_global.c, function name: prom_chksum

	c) for loop index i name changed to pl_tm_index
	  in file: HAL_Payload.c, function name: rHAL_pl1_ON

	d) for loop index i name changed to pl_tm_index
	  in file: HAL_Payload.c, function name: rHAL_pl2_ON

	e) rHAL_RW_TM_Read() function's second argument is modified
	  from RW_TM to RW_TM_data in file: HAL_RW.c,
	  function name: rHAL_RW_TM_Read
	
	f) variable declaration "Nodeptrtype temp" was declared 
	  in Telecommand.h as global varible, which is now removed. 
	  the local declation of variable temp with Nodeptrtype remains
	  unchanged in functions rAbsoluteTTC_Update(), rAbsoluteTTC_Delete()
	  rAbsoluteTTC_Clear()

	g) variable declaration "Nodeptrtype prev" was declared 
	  in Telecommand.h as global varible, which is now removed. 
	  the local declation of variable temp with Nodeptrtype remains
	  unchanged in functions rAbsoluteTTC_Delete()

	h) variable declaration "Nodeptrtype new_data" was declared 
	  in Telecommand.h as global varible, which is now removed. 
	  the local declation of variable temp with Nodeptrtype remains
	  unchanged in functions rAbsoluteTTC_Update()

	i) variable declaration "Nodeptrtype new_node" was declared 
	  in Telecommand.h as global varible, which is now removed. 
	  the local declation of variable temp with Nodeptrtype remains
	  unchanged in functions rAbsoluteTTC_Update()

	j) for loop index i name changed to frame_1_filler_index
	  in file: Telemetry.c, function name: Norm_ST_1_Table_Init, FRAME: 1

	k) for loop index i name changed to frame_1_filler_index
	  in file: Telemetry.c, function name: Norm_ST_1_Table_Init, FRAME: 2

	l) for loop index i name changed to frame_1_filler_index
	  in file: Telemetry.c, function name: Norm_ST_1_Table_Init, FRAME: 3
	
	m) variable filler_byte1, filler_byte2, filler_byte3 is removed, 
	   instead variable filler_byte is used for padding zeros in normal
	   storage telemetry frame.

	n) int i; in file: Global.c, function: rPor_Init() is changed to
	   unsigned char tm_nsp_addr_index; used in copying the NSP address 
	   in to  telemetry channels.  

	o) for loop index i name changed to MUX_index 
	  in file: HAL_global.c, function name: MUX_Output 

	p) Global declaration of variable MTR_Axis and MTR_Polarity is 
	   removed in file: HAL_MTR.c, and HAL_MTR.h, function name: rHAL_MTR_TC

	q) for loop index i name changed to pl_st_write_index
	  in file: HAL_Payload.c, function name: pl_tx_tm

	r) Global declaration of varible inter_HAL_RW_Status_Register is removed,
	   in file: HAL_RW.h, function name: rHAL_RW_TM_Read 
	
	s) Global declaration of varible RW_number is removed,
	   in file: Telecommand.h, function name: rData_TC

	t) for loop index i name changed to remote_monitor_index
	  in file: Telecommand.c, function name: rRemote_data_view 
	  (function was also modiefied, testing is pending)
	
	u) for loop index i name changed to attc_node_index
	  in file: Telecommand.c, function name: initNodetable

	v) for loop index i name changed to invert_index
	  in file: Telecommand.c, function name: invertReverse

	w) for loop index i name changed to BCH_index
	  in file: Telecommand.c, function name: BCHEncoder
	
	x) for loop index j name changed to BCH_index_1
	  in file: Telecommand.c, function name: BCHEncoder

	y) for loop index i name changed to HW_sts_update_index
	  in file: Telemetry.c, function name: rHAL_TM_HW_Status_Update

	z) for loop index j name changed to subframe_copy_index
	    in file: Telemetry.c, function name: ST_Copy_Subframe

	aa) for loop index i name changed to buf256_index
	    in file: Telemetry.c, function name: rTCH_dump_cpy_buf 
	    and rTCH_full_dump_cpy_buf
	
	ab) for loop index j name changed to TCH_cpy_index
	    in file: Telemetry.c, function name: rTCH_dump_cpy_buf 
	    and rTCH_full_dump_cpy_buf

	ac) for loop index k name changed to Storage_buf_index
	    in file: Telemetry.c, function name: copy_frame
	
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	++++++++++++++++++++++++++++++++
	+ Changes made on 27 JULY 2020 +
	++++++++++++++++++++++++++++++++
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
1. defualt case has been removed in File: HAL_Global.c Function: MUX_Output()
2. if condtion logic if((RAM_SEG_START_ADDR < Remote_data_addr >RAM_SEG_END_ADDR) is modified to
	if((RAM_SEG_START_ADDR< Remote_data_addr) && (Remote_data_addr > RAM_SEG_END_ADDR))
	 File: Telecommand.c Function: rRemote_data_view
3.. if condition and else conditions has been modified in block_update routine
   BLK_opn == 00, BLK_opn == 01, and BLK_opn == 10 is modiefied to BLK_opn == 0x0,
	 BLK_opn == 0x1, and BLK_opn == 0x2 respectively.
   File: Telecommand.c Function: block_update

4. First argument of ST_Copy_Subframe data type is modiefied from int to unsigned int.
   File: Telemetry.c Function: ST_Copy_Subframe

5. Local variable frame_addr is renamed as frame_addr_sel 
   File: Telemetry.c Function: Frame_Address_Select

6. Unused routine rpl_init() and variable rHAL_pl_sts_check_mj_flag has been 
	removed from HAL_Palyoad.c File
7. Condition if ((BLK_number < 64) && (u_TC.BLK_Update_cmd.Cmd_Srl < 64)) is removed 
	 File: Telecommand.c Function: Block_update()
8. Multiple if conditions with same condtional statement has been removed (if (CB_Torquer_Polarity_Check == 1))
	File: HAL_MTR.c Function: rHAL_MTR()
9. Removed tempdata variable declaration and assignment.
	File: HAL_ADC.c Function: rHAL_ADC_TM_Copy()
10. Removed assignment and declaration of tempdata3 tempdata2.
	File: HAL_Payload.c Function: pl_tx_tm_2()
11. Removed tempdata = *pl_data_addr statement.
	File: HAL_Payload.c Function: rpl_tm_write()
12. Removed NOB_Write_rw = 11 statement.
	File: HAL_RW.c Function: rRW_init_cmd()
13. Commented   tempdata = (inter_TM_Status_Data | 0x00000001) statement 
    (Has to be verified with Prof. Priyanka)
	File: Telemetry.c Function: rHAL_TM_Write()
14. Removed line frame_addr = Special_st_table_page2 statement and 
	added - 	
	if (TC_gain_select_u.TC_gain_select_Table.TC_ST_Format_Selection == 2)
	{
		frame_addr = Special_st_table_page2;
		ST_special.ST_SP_Buffer.Sub_Frame = 2;
	}
	File: Telemetry.c Function: ST_Copy_Subframe
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	++++++++++++++++++++++++++++++++
	+ Changes made on 28 JULY 2020 +
	++++++++++++++++++++++++++++++++
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

1.Remote_data_view routine is tested with modification in if condition and 
  also remote_base_addr is being telemetered.

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	++++++++++++++++++++++++++++++++
	+ Changes made on 29 JULY 2020 +
	++++++++++++++++++++++++++++++++
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

1. ST_dumping routine:read_ptr was graeter then write_ptr. it is changed to greater 
     than or equal to condition (if(!(read_str_ptr >= (unsigned short*)write_str_ptr)))
2.changed ST_frame_count to ST_TCH_frame_count  
   File: Telemetry.c Function:  rTCH_full_dump_cpy_buf(),rTCH_dump_cpy_buf().
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	++++++++++++++++++++++++++++++++
	+ Changes made on 30 JULY 2020 +
	++++++++++++++++++++++++++++++++
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
1.TM_write routine write_enable bit was commented that is removed.
   File: Telemetry.c Function: rHAL_TM_Write().
2.If condition is added in ATTC_delete function to over come the hanging issue.
  File: Telecommand.c Function: rAbsoluteTTC_Delete().
  
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	++++++++++++++++++++++++++++++++
	+ Changes made on 03 AUG 2020 +
	++++++++++++++++++++++++++++++++
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

1. adcs.ADandEst.c: Added Qs_Normalization in rError_Computation
2. adcs.ADandEst.c: Added EKF 2 (rExtendedKalmanFilter2_p1, rExtendedKalmanFilter2_Prop,
 rExtendedKalmanFilter2_p2, rEKFDynamics, rEKF_dy_int)
3. adcs.ADandEst.h: Declared EKF2 related variables
// Extended Kalman Filter 2

int ecl_ekf, kfmeas, tor_counterk;

double T_RW_NETk[3], T_MTk[3], Mk[3], T_MTk[3], T_NETk[3], w_k[3], RWSpeedk[4];
double b_k[3], lpfx_magbk, lpfy_magbk, lpfz_magbk, lpfb_k[3], lpfb_k_prev[3];
double pbk, qqbk;

double kfk1[4], kfq_dot[4], kfg1[3], kfw_dot[3], kfv1[4], kfv_dot[4], kfq01[4], kfw01[3], kfv01[4];
double kfk2[4], kfg2[3], kfv2[4], kfq02[4], kfw02[3], kfv02[4];
double kfk3[4], kfg3[3], kfv3[4], kfq03[4], kfw03[3], kfv03[4];
double kfk4[4], kfg4[3], kfv4[4];

double kfom[4][4], kfq_dot[4], kfv_dot[4], kfT_RW_NET_temp[4], kfT_RW_NET[3], kfH_wh_ind[4], kfH_wh2body[3], kfI_MAT_w0[3], kfI_MAT_w0_HW2B[3], kfT_NET[3], kfw0crossI_MAT_w0_HW2B[3], kfw_dot_temp[3], kfw_dot[3];
int f_EKF2_prop_en,f_EKF2_mag_bias_dis;

4. adcs_Constants.c: c_MiC updated to 0.032 from 0.016
5. adcs_Constants.c: Updated c_gval, c_gsval, c_hval, c_hsval, 
// Mag Bias LUT

const int c_DPM_Pol_LookUpTable[27][3] = {
	{   0,	0,	0},
	{   0,	0,	1},
	{   0,	0,	-1},
	{   0,	1,	0},
	{   0,	-1,	0},
	{   1,	0,	0},
	{   -1,	0,	0},
	{   0,	1,	1},
	{   0,	1,	-1},
	{   0,	-1,	-1},
	{   0,	-1,	1},
	{   1,	0,	1},
	{   -1,	0,	-1},
	{   -1,	0,	1},
	{   1,	0,	-1},
	{   1,	1,	0},
	{   -1,	-1,	0},
	{   -1,	1,	0},
	{   1,	-1,	0},
	{   1,	1,	1},
	{   -1,	-1,	-1},
	{   -1,	1,	1},
	{   1,	-1, 1},
	{   -1,	1,	-1},
	{   1,	1,	-1},
	{   -1,	-1,	1},
	{   1,	-1,	-1}


	};
	
6. adcs_GPS_OD.c: Updated rGPSDataProcessing routine name to rGPSTLEProcessing
7. adcs_GPS_OD.c: Added if condition in rGPSTLEProcessing
if(TLE_Data_Available == 1) //TLE data availability flag irrespective of TLE or GPS selection
	{
		TC_Tsince_TLE_tc = 0.0;
		TLE_Data_Available = 0;
	}

8. adcs_GPS_OD.h : 
Added double xa_gcgd, mua_gcgd,ra_gcgd,l_gcgd,dlambda_gcgd,h_gcgd,den_gcgd,rhoa_gcgd,dmu_gcgd,gd_gcgd;

9. adcs_GPS_OD.c: Removed rGPS_data_validity
10. adcs_GPS_OD.c: Removed .........
11. adcs_LinearController.c: Added in rLinearController
if (TC_boolean_u.TC_Boolean_Table.TC_EKF2_Enable == 1 && TC_boolean_u.TC_Boolean_Table.TC_EKFControl_Enable == 1)
{
	Tc[0] = (TC_KP[0]*Qerror[0] + TC_KR[0]*(w_k[0]-w_REF[0]));
	Tc[1] = (TC_KP[1]*Qerror[1] + TC_KR[1]*(w_k[1]-w_REF[1]));
	Tc[2] = (TC_KP[2]*Qerror[2] + TC_KR[2]*(w_k[2]-w_REF[2]));
}
else
{
	Tc[0] = (TC_KP[0]*Qerror[0] + TC_KR[0]*(w_BODY[0]-w_REF[0]));
	Tc[1] = (TC_KP[1]*Qerror[1] + TC_KR[1]*(w_BODY[1]-w_REF[1]));
	Tc[2] = (TC_KP[2]*Qerror[2] + TC_KR[2]*(w_BODY[2]-w_REF[2]));
}
12. adcs_LinearController.c: Removed in rDutyCycleGeneration
if (CB_Detumbling_Mode == 1)
{
	Ton[0] = MTR_ActuationCycle;
	Toff[0] = 0;

	Ton[1] = MTR_ActuationCycle;
	Toff[1] = 0;

	Ton[2] = MTR_ActuationCycle;
	Toff[2] = 0;
}
12. adcs_RefCom